<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026ë…„ ì•ˆì „&í™˜ê²½ ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸</title>
    
    <!-- ì™¸ë¶€ íŒŒì¼ ì—°ê²°: ê²½ë¡œê°€ ì •í™•í•œì§€, íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸ í•„ìˆ˜ -->
    <link rel="stylesheet" href="style.css">
    <script src="data.js"></script>
    
    <!-- PDF ì €ì¥ìš© ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ 2026ë…„ ì•ˆì „&í™˜ê²½ ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
            <p>ì„¤ë¹„ê¸°íšê·¸ë£¹ í”„ë¡œì íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </div>

        <div class="input-section">
            <div class="input-grid">
                <div class="input-group">
                    <label>ğŸ’° ê³µì‚¬ê¸ˆì•¡ (ì–µì›)</label>
                    <input type="range" id="contractAmount" min="0" max="100" value="50" step="1">
                    <input type="number" id="contractAmountInput" value="50" style="width: 60px; margin-left:10px;">
                    <span id="amountDisplay">50 ì–µì›</span>
                </div>
                <div class="input-group">
                    <label>â±ï¸ ê³µì‚¬ê¸°ê°„ (ê°œì›”)</label>
                    <input type="range" id="contractPeriod" min="0" max="36" value="12" step="1">
                    <input type="number" id="contractPeriodInput" value="12" style="width: 60px; margin-left:10px;">
                    <span id="periodDisplay">12 ê°œì›”</span>
                </div>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button id="updateBtn" onclick="updateAndNotify()" style="background:var(--secondary-blue); color:white; padding:12px 30px; border:none; border-radius:8px; cursor:pointer; font-weight:700; font-size:1rem; transition:all 0.3s; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);">ğŸ“Š ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸</button>
                <button onclick="window.print()" style="background:var(--primary-blue); color:white; padding:12px 30px; border:none; border-radius:8px; cursor:pointer; font-weight:700; font-size:1rem; margin-left:15px; transition:all 0.3s; box-shadow: 0 4px 15px rgba(30, 58, 138, 0.4);">ğŸ–¨ï¸ PDF ì €ì¥</button>
            </div>
        </div>

        <div class="step-nav" id="stepNav">
            <button class="step-tab active" onclick="switchStep(1)">â… . ì•ˆì „&í™˜ê²½</button>
            <button class="step-tab" onclick="switchStep(2)">â…¡. ì‹œê³µê³„íšì„œ</button>
            <button class="step-tab" onclick="switchStep(3)">â…¢. ì°©ê³µê³„</button>
            <button class="step-tab" onclick="switchStep(4)">â…£. ì°©ê³µ ì‹œ</button>
        </div>

        <div class="table-section">
            <div id="step1" class="step-content active"></div>
            <div id="step2" class="step-content"></div>
            <div id="step3" class="step-content"></div>
            <div id="step4" class="step-content"></div>
        </div>
    </div>

    <!-- ì°¸ê³ í‘œ ëª¨ë‹¬ -->
    <div id="referenceModal" class="modal">
        <div class="modal-content">
            <div style="background:var(--primary-blue); color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center;">
                <h2 id="modalTitle" style="font-size:1.2rem;">ì°¸ê³  ê¸°ì¤€</h2>
                <span onclick="document.getElementById('referenceModal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span>
            </div>
            <div id="modalBody" style="padding:20px;"></div>
        </div>
    </div>

    <script>
        // === ReferenceError ë°©ì§€ë¥¼ ìœ„í•œ ë°ì´í„° ì²´í¬ ë¡œì§ ===
        function checkDataLoaded() {
            if (typeof checklistData === 'undefined') {
                console.error("ë°ì´í„° íŒŒì¼(data.js)ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì´ ë™ì¼í•œ ê²½ë¡œì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
                document.body.innerHTML = `
                    <div style="padding: 50px; text-align: center; font-family: sans-serif;">
                        <h2 style="color: #ef4444;">âš ï¸ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜</h2>
                        <p>'data.js' íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="font-size: 0.9rem; color: #666;">index.htmlê³¼ data.js íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
                    </div>
                `;
                return false;
            }
            return true;
        }

        function updateSliderValues() {
            const amount = document.getElementById("contractAmount").value;
            const period = document.getElementById("contractPeriod").value;
            document.getElementById("amountDisplay").innerText = amount + " ì–µì›";
            document.getElementById("periodDisplay").innerText = period + " ê°œì›”";
            document.getElementById("contractAmountInput").value = amount;
            document.getElementById("contractPeriodInput").value = period;
        }

        function switchStep(step) {
            if (!checkDataLoaded()) return;
            document.querySelectorAll(".step-content").forEach(c => c.classList.remove("active"));
            document.querySelectorAll(".step-tab").forEach(t => t.classList.remove("active"));
            document.getElementById(`step${step}`).classList.add("active");
            document.querySelectorAll(".step-tab")[step-1].classList.add("active");
            renderStep(step);
        }

        function renderStep(step) {
            if (!checkDataLoaded()) return;
            
            const amount = parseFloat(document.getElementById("contractAmount").value);
            const period = parseFloat(document.getElementById("contractPeriod").value);
            const container = document.getElementById(`step${step}`);
            const data = checklistData[step];

            if (!data) return;

            let html = `<h2 style="color:var(--primary-blue); margin-bottom:20px; font-weight:800; border-left:5px solid var(--accent-blue); padding-left:15px;">${data.title}</h2>`;
            html += `<table><thead><tr>
                <th>No.</th><th>ì„œë¥˜ ì¢…ë¥˜</th><th>í•„ìˆ˜ ì—¬ë¶€</th><th>ìƒì„¸ ì„¤ëª…</th><th>ë©´ì œ ì¡°ê±´</th><th>íŠ¹ì´ì‚¬í•­</th>
            </tr></thead><tbody>`;

            data.items.forEach((item, index) => {
                const isRequired = (item.status === "â—") || (amount >= item.baseAmount && period >= item.basePeriod);
                html += `<tr>
                    <td>${index + 1}</td>
                    <td>
                        <span style="display:block;">${item.name}</span>
                        ${item.reference ? `<button onclick="openReference('${item.reference}')" style="font-size:10px; padding:2px 5px; cursor:pointer; margin-top:5px; background:white; border:1px solid #ddd; border-radius:3px;">ğŸ” ${item.reference}</button>` : ''}
                    </td>
                    <td><span class="status-badge ${isRequired ? 'required' : 'exempt'}">${isRequired ? 'í•„ìˆ˜' : 'ë¯¸í•´ë‹¹'}</span></td>
                    <td>${item.description ? item.description.replace(/\n/g, '<br>') : ''}</td>
                    <td>${item.exemption ? item.exemption.replace(/\n/g, '<br>') : ''}</td>
                    <td style="color:#666;">${item.remark ? item.remark.replace(/\n/g, '<br>') : ''}</td>
                </tr>`;
            });

            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        function openReference(refName) {
            if (typeof referenceData === 'undefined') return;
            const ref = referenceData[refName];
            if(!ref) return;
            document.getElementById("modalTitle").innerText = ref.title;
            let tableHtml = `<table style="font-size:12px;"><thead><tr>`;
            ref.data[0].forEach(h => { tableHtml += `<th>${h}</th>`; });
            tableHtml += `</tr></thead><tbody>`;
            for(let i=1; i<ref.data.length; i++) {
                tableHtml += `<tr>`;
                ref.data[i].forEach(d => { tableHtml += `<td>${d}</td>`; });
                tableHtml += `</tr>`;
            }
            tableHtml += `</tbody></table>`;
            document.getElementById("modalBody").innerHTML = tableHtml;
            document.getElementById("referenceModal").style.display = "block";
        }

        function updateAndNotify() {
            if (!checkDataLoaded()) return;
            const btn = document.getElementById("updateBtn");
            btn.innerHTML = "ì—…ë°ì´íŠ¸ ì¤‘...";
            btn.disabled = true;

            setTimeout(() => {
                [1,2,3,4].forEach(renderStep);
                btn.innerHTML = "ğŸ“Š ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸";
                btn.disabled = false;
                alert('ì—…ë°ì´íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤.\në°ì´í„°ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.');
            }, 500);
        }

        // ì´ˆê¸°í™”
        document.getElementById("contractAmount").oninput = updateSliderValues;
        document.getElementById("contractPeriod").oninput = updateSliderValues;
        
        window.onload = () => {
            if (checkDataLoaded()) {
                updateSliderValues();
                renderStep(1);
            }
        };
    </script>
</body>
</html>